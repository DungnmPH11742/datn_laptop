<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>Cart | E-Shopper</title>
	<link th:href="@{/user-st/css/bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/font-awesome.min.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/prettyPhoto.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/price-range.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/animate.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/cart.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/responsive.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/form-check-out.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/main.css}" rel="stylesheet">

	<script th:src="@{/user-st/js/html5shiv.js}"></script>
	<script th:src="@{/user-st/js/respond.min.js}"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css">

</head>
<!--/head-->

<body>
<!--/header-->
<div th:replace="~{common/header :: headers}"></div>
<!--/header-->


<main class="container">
	<section id="clearfix" >
		<div class="cart_items" >
			<div class="breadcrumbs">
				<ol class="breadcrumb">
					<li><a href="#">Home</a></li>
					<li class="active">Giỏ hàng</li>
				</ol>
			</div>
			<!--Title page-->
			<h1>Giỏ Hàng</h1>
			<div class="not-cart" th:if="${session.myCart == null}">
				Bạn chưa có sản phẩm nào trong giỏ hàng
			</div>
			<!--Form cart-->
			<div class="row form-cart" th:if="${session.myCart != null}">
				<div class="col-sm-9" >
					<!--Header form cart-->
					<div class="header-form-left">
						<div class="cart-col-product"><span>Tất cả (<span th:id="numberItemInCart">[[${session.myCart.getListCartItem.size() > 0?session.myCart.getListCartItem.size():0}]]</span> sản phẩm)</span></div>
						<div class="cart-col-price">Đơn giá</div>
						<div class="cart-col-quantity">Số lượng</div>
						<div class="cart-col-total-price">Thành tiền</div>
						<div class="cart-col-delete">
							<a href="#" class="delete-all-item">
								<i class="far fa-trash-alt"></i>
								<span class="canh-bao">Xóa toàn bộ giỏ hàng</span>
							</a>

						</div>
					</div>

					<div class="list-product-cart" th:id="pro + ${item.sku}" th:each="item : ${session.myCart.getListCartItem()}">

						<!--Product 01-->
						<div class="product-cart"  >
							<div class="cart-col-product">
								<div class="img-product-cart">
									<a href="#"><img width="100%"
													 th:src="${item.imgUrl==''?'/user-st/images/product/HPZB15G5.jpg':item.imgUrl}" alt=""></a>
								</div>
								<div class="info-product-cart">
									<div class="name-product-cart">
										[[${item.nameProduct}]]
									</div>
									<div class="more-product-cart">
										<div class="cate-product">Hãng: <span th:text="${item.nameCate}"></span></div>
									</div>
								</div>
							</div>

							<div class="cart-col-price">
								<div class="price-unit" th:id="ps + ${item.sku}">[[${#numbers.formatDecimal(item.priceSale, 1, 'DEFAULT', 0, 'DEFAULT')}]]đ</div>

								<s class="price-sale" th:if="${item.priceSale != item.priceUnit}">[[${#numbers.formatDecimal(item.priceUnit, 1, 'DEFAULT', 0, 'DEFAULT')}]]đ</s>
							</div>

							<!--quantity-->
							<div class="cart-item__cell-quantity order" style="float: right;  margin-right: 75px;">
								<div class="_16mL_A shopee-input-quantity">
									<!--Giảm số lượng-->
									<button class="_2KdYzP" th:attr="onclick=|minusQty('${item.sku}')|">
										<svg enable-background="new 0 0 10 10" viewBox="0 0 10 10" x="0" y="0"
											 class="shopee-svg-icon ">
											<polygon points="4.5 4.5 3.5 4.5 0 4.5 0 5.5 3.5 5.5 4.5 5.5 10 5.5 10 4.5"></polygon>
										</svg>
									</button>
									<input class="_2KdYzP iRO3yj abc" type="number" th:id="${item.sku}" th:value="${item.quantityProduct}" min="1" th:max="${item.quantity}">
									<!--Tăng số lượng-->
									<button class="_2KdYzP" th:attr="onclick=|plusQty('${item.sku}',${item.quantity})|" >
										<svg enable-background="new 0 0 10 10" viewBox="0 0 10 10" x="0" y="0"
											 class="shopee-svg-icon icon-plus-sign">
											<polygon	points="10 4.5 5.5 4.5 5.5 0 4.5 0 4.5 4.5 0 4.5 0 5.5 4.5 5.5 4.5 10 5.5 10 5.5 5.5 10 5.5"></polygon>
										</svg>
									</button>
								</div>
							</div>


							<!--Thành tiền-->
							<div class="cart-col-total-price" th:id="tt + ${item.sku}">
								[[${#numbers.formatDecimal(item.totalPriceCartItem, 1, 'DEFAULT', 0, 'DEFAULT')}]]đ
							</div>

							<!--Delete item-->
							<!--							<div>-->
							<div class="cart-col-delete" th:attr="onclick=|deleteO('${item.sku}','${item.idOrderDetail}')|">
								<a href="#" class="delete-all-item">
									<i class="far fa-trash-alt"></i>
									<span class="canh-bao">Xóa sản phẩm</span>
								</a>

							</div>
							<!--								<button th:attr="onclick=|deleteO('${item.sku}','${item.idOrderDetail}')|">Xóa</button>-->
							<!--							</div>-->
						</div>

						<!-- End Product-->
					</div>
				</div>
				<div class="col-sm-3">
					<div class="checkout-sidebar-right">
						<!--						<div class="checkout-price-unit">-->
						<!--							<div class="checkout-title-price-unit">Tạm tính:</div>-->
						<!--							<div class="checkout-value-price-unit">20.000.000 đ</div>-->
						<!--						</div>-->
						<div class="checkout-price-total">
							<div class="checkout-title-price-total">Thành tiền:</div>
							<div class="checkout-value-price-total" id="totalpriceCart">[[${#numbers.formatDecimal(session.myCart.totalPrice, 1, 'DEFAULT', 0, 'DEFAULT')}]]đ</div>
						</div>
						<div class="checkout-btn">
							<a th:href="@{/checkout}" class="checkout-btn-a">Tiến hành thanh toán</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!--/#cart_items-->
</main>



<!--/Footer-->
<div th:replace="~{common/footer :: footers}"></div>
<!--/Footer-->



<script th:src="@{/user-st/js/jquery.js}"></script>
<script th:src="@{/user-st/js/price-range.js}"></script>
<script th:src="@{/user-st/js/jquery.scrollUp.min.js}"></script>
<script th:src="@{/user-st/js/bootstrap.min.js}"></script>
<script th:src="@{/user-st/js/jquery.prettyPhoto.js}"></script>
<script th:src="@{/user-st/js/main.js}"></script>
<script th:src="@{/user-st/js/checkout.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
<script>

	function plusQty(sku,quanti){
		let qty = $('#'+sku).val();
		if(qty< quanti){
			qty = parseInt(qty);

			// Ajax
			let  data = {
				'sku':sku,
				'quantityProduct':1,
			};
			$.ajax({
				type: "PUT",
				url:"/addToCart",
				contentType: "application/json",
				data: JSON.stringify(data),
				dataType: "JSON",
				success: function (data) {
					if(`${data.message}`== 'maxPrice'){
						alert('Số tiền không được vượt quá 150.000.000đ');
					}else {
						// Tăng số lượng
						qty++;
						$('#'+sku).val(qty);
						console.log(`${data.message}`);

						let totalpriceCart = `
						${data.totalpriceCart.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
					`;
						let totalPriceProduct_dt = `
						${data.totalPriceProduct_dt.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
					`;

						$('#hienThiSoLuong').html('');
						$('#hienThiSoLuong').append(`${data.totalItem}`);
						//
						$('#tt' + sku).html('');
						$('#tt' + sku).append(totalPriceProduct_dt);

						$('#totalpriceCart').html('');
						$('#totalpriceCart').append(totalpriceCart);
						// alert(`${data.message}`);
					}

				},error: function () {
					alert(`${data.message}`);
				}
			});
		}else{
			alert("Đã đạt số lượng tối đa")
		}

	}

	function minusQty(sku){
		let qty = $('#'+sku).val();
		if(qty> 1){
			qty = parseInt(qty);
			qty--;
			$('#'+sku).val(qty);
			// Ajax
			let  data = {
				'sku':sku,
				'quantityProduct':-1,
			};
			$.ajax({
				type: "PUT",
				url:"/addToCart",
				contentType: "application/json",
				data: JSON.stringify(data),
				dataType: "JSON",
				success: function (data) {
					console.log(`${data.message}`);

					let totalpriceCart = `
						${data.totalpriceCart.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
					`;
					let totalPriceProduct_dt = `
						${data.totalPriceProduct_dt.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
					`;

					$('#hienThiSoLuong').html('');
					$('#hienThiSoLuong').append(`${data.totalItem}`);
					//
					$('#tt' + sku).html('');
					$('#tt' + sku).append(totalPriceProduct_dt);

					$('#totalpriceCart').html('');
					$('#totalpriceCart').append(totalpriceCart);
					// alert(`${data.message}`);
				},error: function () {
					alert(`${data.message}`);
				}
			});
		}else{
			alert("Đã đạt số lượng tối thiểu")
		}
	}

	function deleteO(sku, iddetail) {

		if (confirm('Bạn có chắc chắn muốn xóa ??')) {
			$("#pro" + sku).remove();

			let  data = {
				'sku':sku,
				'idOrderDetail': iddetail,
			};
			$.ajax({
				type: "POST",
				url:"/cart-delete-orderdetail",
				contentType: "application/json",
				data: JSON.stringify(data),
				dataType: "JSON",
				success: function (data) {
					let totalpriceCart = `
							${data.totalpriceCart.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
						`;
					//
					$('#totalpriceCart').html('');
					$('#totalpriceCart').append(totalpriceCart);

					$('#hienThiSoLuong').html('');
					$('#hienThiSoLuong').append(`${data.totalItem != null?data.totalItem : 0}`);

					$('#numberItemInCart').html('');
					$('#numberItemInCart').append(`${data.totalItem != null?data.totalItem : 0}`);

				},error: function () {
					alert("Không xóa được");
				}
			});
			$("#notification-compare").append(`<div class="alert alert-success alert-dismissible">
                                                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                                            <strong>Thành công!</strong>
                                                            <p>Đã xóa giỏ hàng thành công</p>
                                                       </div>`);
		}else
		{
			console.log('cancel')
		}


	}

</script>
</body>

</html>