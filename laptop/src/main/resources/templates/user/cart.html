<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>Cart | E-Shopper</title>
	<link th:href="@{/user-st/css/bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/font-awesome.min.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/prettyPhoto.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/price-range.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/animate.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/cart.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/responsive.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/form-check-out.css}" rel="stylesheet">
	<link th:href="@{/user-st/css/main.css}" rel="stylesheet">

	<script th:src="@{/user-st/js/html5shiv.js}"></script>
	<script th:src="@{/user-st/js/respond.min.js}"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css">

</head>
<!--/head-->

<body>
<!--/header-->
<div th:replace="~{common/header :: headers}"></div>
<!--/header-->


<main class="container">
	<section id="clearfix" >
		<div class="cart_items" >
			<div>
				<ul class="breadcrumb pb-8 flex items-center space-x-2">
					<li class="breadcrumb-item home">
						<a href="#" class="nuxt-link-active" itemprop="item">Trang chủ</a>
					</li>
					<li class="breadcrumb-item font-semibold text-sm active">
						<a href="#" aria-current="page"
						   class="text-black flex items-center nuxt-link-exact-active nuxt-link-active"
						   itemprop="item">
							Giỏ hàng
						</a>
					</li>
				</ul>
			</div>
			<!--Title page-->
			<h1>Giỏ Hàng</h1>
			<div class="not-cart" th:if="${session.myCart == null}">
				Bạn chưa có sản phẩm nào trong giỏ hàng
			</div>
			<!--Form cart-->
			<div class="row form-cart" th:if="${session.myCart != null}">
				<div class="col-sm-9" >
					<!--Header form cart-->
					<div class="header-form-left">
						<div class="cart-col-product"><span>Tất cả ([[${session.myCart.getListCartItem.size() > 0?session.myCart.getListCartItem.size():0}]] sản phẩm)</span></div>
						<div class="cart-col-price">Đơn giá</div>
						<div class="cart-col-quantity">Số lượng</div>
						<div class="cart-col-total-price">Thành tiền</div>
						<div class="cart-col-delete">
							<a href="#" class="delete-all-item">
								<i class="far fa-trash-alt"></i>
								<span class="canh-bao">Xóa toàn bộ giỏ hàng</span>
							</a>

						</div>
					</div>

					<div class="list-product-cart" th:id="pro + ${item.idProduct}" th:each="item : ${session.myCart.getListCartItem()}">

						<!--Product 01-->
						<div class="product-cart"  >
							<div class="cart-col-product">
								<div class="img-product-cart">
									<a href="#"><img width="100%"
													 th:src="${item.imgUrl==''?'/user-st/images/product/HPZB15G5.jpg':item.imgUrl}" alt=""></a>
								</div>
								<div class="info-product-cart">
									<div class="name-product-cart">
										[[${item.nameProduct}]]
									</div>
									<div class="more-product-cart">
										<div class="cate-product">Hãng: <span th:text="${item.nameCate}"></span></div>
									</div>
								</div>
							</div>

							<div class="cart-col-price">
								<div class="price-unit" th:id="ps + ${item.idProduct}">[[${#numbers.formatDecimal(item.priceSale, 1, 'DEFAULT', 0, 'DEFAULT')}]]đ</div>
								<s class="price-sale">[[${#numbers.formatDecimal(item.priceUnit, 1, 'DEFAULT', 0, 'DEFAULT')}]]đ</s>
							</div>

							<!--quantity-->
							<div class="cart-item__cell-quantity order" style="float: right;  margin-right: 75px;">
								<div class="_16mL_A shopee-input-quantity">
							<!--Giảm số lượng-->
									<button class="_2KdYzP" th:attr="onclick=|minusQty('${item.idProduct}')|">
										<svg enable-background="new 0 0 10 10" viewBox="0 0 10 10" x="0" y="0"
											 class="shopee-svg-icon ">
											<polygon points="4.5 4.5 3.5 4.5 0 4.5 0 5.5 3.5 5.5 4.5 5.5 10 5.5 10 4.5"></polygon>
										</svg>
									</button>
									<input class="_2KdYzP iRO3yj abc" type="number" th:id="${item.idProduct}" th:value="${item.quantityProduct}" min="1" th:max="${item.quantity}">
							<!--Tăng số lượng-->
									<button class="_2KdYzP" th:attr="onclick=|plusQty('${item.idProduct}','${item.quantity}')|" >
										<svg enable-background="new 0 0 10 10" viewBox="0 0 10 10" x="0" y="0"
											 class="shopee-svg-icon icon-plus-sign">
											<polygon	points="10 4.5 5.5 4.5 5.5 0 4.5 0 4.5 4.5 0 4.5 0 5.5 4.5 5.5 4.5 10 5.5 10 5.5 5.5 10 5.5"></polygon>
										</svg>
									</button>
								</div>
							</div>


							<!--Thành tiền-->
							<div class="cart-col-total-price" th:id="tt + ${item.idProduct}">
								[[${#numbers.formatDecimal(item.totalPriceCartItem, 1, 'DEFAULT', 0, 'DEFAULT')}]]đ
							</div>

							<!--Delete item-->
							<div>
								<button th:attr="onclick=|deleteO('${item.idProduct}','${item.idOrderDetail}')|">Xóa</button>
							</div>
						</div>

						<!-- End Product-->
					</div>
				</div>
				<div class="col-sm-3">
					<div class="checkout-sidebar-right">
<!--						<div class="checkout-price-unit">-->
<!--							<div class="checkout-title-price-unit">Tạm tính:</div>-->
<!--							<div class="checkout-value-price-unit">20.000.000 đ</div>-->
<!--						</div>-->
						<div class="checkout-price-total">
							<div class="checkout-title-price-total">Thành tiền:</div>
							<div class="checkout-value-price-total" id="sumprice">[[${#numbers.formatDecimal(session.myCart.totalPrice, 1, 'DEFAULT', 0, 'DEFAULT')}]]đ</div>
						</div>
						<div class="checkout-btn">
							<a th:href="@{/checkout}" class="checkout-btn-a">Tiến hành thanh toán</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!--/#cart_items-->
</main>



<!--/Footer-->
<div th:replace="~{common/footer :: footers}"></div>
<!--/Footer-->



<script th:src="@{/user-st/js/jquery.js}"></script>
<script th:src="@{/user-st/js/price-range.js}"></script>
<script th:src="@{/user-st/js/jquery.scrollUp.min.js}"></script>
<script th:src="@{/user-st/js/bootstrap.min.js}"></script>
<script th:src="@{/user-st/js/jquery.prettyPhoto.js}"></script>
<script th:src="@{/user-st/js/main.js}"></script>
<script th:src="@{/user-st/js/checkout.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
<script>

	function plusQty(idPro,quanti){
		let qty = $('#'+idPro).val();
		if(qty< quanti){
			qty = parseInt(qty);
			qty++;
			$('#'+idPro).val(qty);
			// Ajax
			let  data = {
				'idProduct':idPro,
				'quantityProduct':1,
			};
			$.ajax({
				type: "PUT",
				url:"/addToCart",
				contentType: "application/json",
				data: JSON.stringify(data),
				dataType: "JSON",
				success: function (data) {
					console.log(`${data.message}`);

					let sumprice = `
						${data.sumPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
					`;
					let totalPrice = `
						${data.totalPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
					`;

					$('#hienThiSoLuong').html('');
					$('#hienThiSoLuong').append(`${data.totalItem}`);
					//
					$('#tt' + idPro).html('');
					$('#tt' + idPro).append(totalPrice);

					$('#sumprice').html('');
					$('#sumprice').append(sumprice);
					alert(`${data.message}`);
				},error: function () {
					alert(`${data.message}`);
				}
			});
		}else{
			alert("Đã đạt số lượng tối đa")
		}

	}

	function minusQty(idPro){
		let qty = $('#'+idPro).val();
		if(qty>1){
			qty = parseInt(qty);
			qty--;
			$('#'+idPro).val(qty);
			// Ajax
			let  data = {
				'idProduct':idPro,
				'quantityProduct':-1,
			};
			$.ajax({
				type: "PUT",
				url:"/addToCart",
				contentType: "application/json",
				data: JSON.stringify(data),
				dataType: "JSON",
				success: function (data) {
					let totalPrice = `
						${data.totalPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
					`;
					let sumprice = `
						${data.sumPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
					`;

					//
					$('#tt' + idPro).html('');
					$('#tt' + idPro).append(totalPrice);

					$('#sumprice').html('');
					$('#sumprice').append(sumprice);
					alert(`${data.message}`);
				},error: function () {
					alert(`${data.message}`);
				}
			});
		}else{
			alert("Đã đạt số lượng tối thiểu")
		}
	}

	function deleteO(idpro, iddetail) {
		$("#pro" + idpro).remove();

		let  data = {
			'idProduct':idpro,
			'idOrderDetail': iddetail,
		};
		$.ajax({
			type: "POST",
			url:"/cart-delete-orderdetail",
			contentType: "application/json",
			data: JSON.stringify(data),
			dataType: "JSON",
			success: function (data) {
				let sumprice = `
						${data.sumPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")} đ
					`;
				//
				$('#sumprice').html('');
				$('#sumprice').append(sumprice);

			},error: function () {
				alert("Không xóa được");
			}
		});

	}

</script>
</body>

</html>